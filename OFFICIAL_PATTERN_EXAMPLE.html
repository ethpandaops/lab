<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECharts 6 - World Map Scatter (Official Pattern)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        #main {
            width: 100%;
            height: 600px;
            background: #2a2a2a;
        }
        .info {
            margin-bottom: 20px;
            padding: 15px;
            background: #333;
            border-radius: 5px;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .code {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            overflow-x: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="info">
        <h1>ECharts 6 - World Map with Scatter (Official Pattern)</h1>
        <p>Based on <a href="https://echarts.apache.org/examples/en/editor.html?c=geo-svg-scatter-simple"
           style="color: #4CAF50;">geo-svg-scatter-simple</a> official example</p>
        <button onclick="addPoints()">Add 100 Points</button>
        <button onclick="resetPoints()">Reset</button>
        <button onclick="toggleEffect()">Toggle Effect</button>
        <span id="count">Points: 10</span>
    </div>

    <div id="main"></div>

    <script>
        var myChart = echarts.init(document.getElementById('main'));
        var useEffect = false;

        // Sample cities
        var cities = [
            { name: 'New York', coords: [-74.006, 40.7128], value: 150 },
            { name: 'London', coords: [-0.1276, 51.5074], value: 120 },
            { name: 'Tokyo', coords: [139.6917, 35.6895], value: 200 },
            { name: 'Sydney', coords: [151.2093, -33.8688], value: 80 },
            { name: 'São Paulo', coords: [-46.6333, -23.5505], value: 90 },
            { name: 'Mumbai', coords: [72.8777, 19.076], value: 110 },
            { name: 'Paris', coords: [2.3522, 48.8566], value: 95 },
            { name: 'Berlin', coords: [13.405, 52.52], value: 85 },
            { name: 'Singapore', coords: [103.8198, 1.3521], value: 130 },
            { name: 'Dubai', coords: [55.2708, 25.2048], value: 75 }
        ];

        var points = cities.slice();

        function generateRandomPoints(count) {
            var newPoints = [];
            for (var i = 0; i < count; i++) {
                var lat = Math.random() * 160 - 80;
                var lon = Math.random() * 360 - 180;
                newPoints.push({
                    name: 'Node ' + i,
                    coords: [lon, lat],
                    value: Math.floor(Math.random() * 100) + 1
                });
            }
            return newPoints;
        }

        // Convert to ECharts format [lng, lat, value]
        function convertData(data) {
            return data.map(function(item) {
                return {
                    name: item.name,
                    value: item.coords.concat(item.value)
                };
            });
        }

        function updateChart() {
            // EXACT PATTERN from geo-svg-scatter-simple example
            var option = {
                backgroundColor: '#1a1a1a',

                tooltip: {
                    trigger: 'item',
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    borderColor: '#333',
                    textStyle: {
                        color: '#fff'
                    },
                    formatter: function(params) {
                        if (params.value) {
                            return params.name + '<br/>Value: ' + params.value[2];
                        }
                        return params.name;
                    }
                },

                // Geo component - matches official example pattern
                geo: {
                    tooltip: {
                        show: true
                    },
                    map: 'world',
                    roam: true,
                    itemStyle: {
                        areaColor: '#323c48',
                        borderColor: '#404a59',
                        borderWidth: 0.5
                    },
                    emphasis: {
                        itemStyle: {
                            areaColor: '#2a333d'
                        },
                        label: {
                            show: false
                        }
                    }
                },

                // Series - matches official example pattern
                series: {
                    type: useEffect ? 'effectScatter' : 'scatter',
                    coordinateSystem: 'geo',
                    geoIndex: 0,
                    // Dynamic symbol size - same pattern as official example
                    symbolSize: function(params) {
                        return (params[2] / 100) * 15 + 5;
                    },
                    itemStyle: {
                        color: '#b02a02',
                        shadowBlur: 10,
                        shadowColor: '#b02a02'
                    },
                    emphasis: {
                        scale: true,
                        itemStyle: {
                            shadowBlur: 20
                        }
                    },
                    encode: {
                        tooltip: 2
                    },
                    data: convertData(points),
                    // Performance optimizations
                    large: points.length > 1000,
                    progressive: 500,
                    progressiveThreshold: 1000
                }
            };

            myChart.setOption(option, {
                notMerge: false,
                replaceMerge: ['series']
            });

            document.getElementById('count').textContent = 'Points: ' + points.length;
        }

        // Load world map - same pattern as official example
        $.get('https://cdn.jsdelivr.net/npm/echarts@5.5.0/map/json/world.json', function(worldJson) {
            // Register map - same as echarts.registerMap('iceland_svg', { svg: svg })
            echarts.registerMap('world', worldJson);

            updateChart();

            // Click handler - same as official example
            myChart.getZr().on('click', function(params) {
                var pixelPoint = [params.offsetX, params.offsetY];
                var dataPoint = myChart.convertFromPixel({ geoIndex: 0 }, pixelPoint);
                console.log('Clicked coordinates:', dataPoint);
            });
        });

        function addPoints() {
            var newPoints = generateRandomPoints(100);
            points = points.concat(newPoints);
            updateChart();
        }

        function resetPoints() {
            points = cities.slice();
            updateChart();
        }

        function toggleEffect() {
            useEffect = !useEffect;
            updateChart();
        }

        window.addEventListener('resize', function() {
            myChart.resize();
        });
    </script>

    <div class="info" style="margin-top: 20px;">
        <h3>✅ This Follows the Official ECharts Pattern</h3>
        <div class="code">
// From: https://echarts.apache.org/examples/en/editor.html?c=geo-svg-scatter-simple

geo: {
    tooltip: { show: true },
    map: 'world',              // or 'iceland_svg' in the example
    roam: true
},

series: {
    type: 'effectScatter',     // or 'scatter'
    coordinateSystem: 'geo',
    geoIndex: 0,
    symbolSize: function(params) {
        return (params[2] / 100) * 15 + 5;  // Dynamic sizing
    },
    data: [...]
}
        </div>

        <h3>Key Differences from 3D Version</h3>
        <ul>
            <li>✅ <code>geo</code> instead of <code>geo3D</code></li>
            <li>✅ <code>type: 'scatter'</code> instead of <code>scatter3D</code></li>
            <li>✅ <code>coordinateSystem: 'geo'</code> instead of <code>geo3D</code></li>
            <li>✅ No echarts-gl dependency</li>
            <li>✅ Canvas renderer (not WebGL)</li>
            <li>✅ Works with GeoJSON or SVG maps</li>
        </ul>

        <h3>Resources</h3>
        <ul>
            <li><a href="https://echarts.apache.org/examples/en/editor.html?c=geo-svg-scatter-simple" style="color: #4CAF50;">geo-svg-scatter-simple</a> - Official example</li>
            <li><a href="https://github.com/apache/echarts-examples" style="color: #4CAF50;">echarts-examples</a> - Source code repository</li>
            <li><a href="https://github.com/apache/echarts/blob/master/test/geo-svg.html" style="color: #4CAF50;">geo-svg.html</a> - Test file</li>
        </ul>
    </div>
</body>
</html>
